<div class='pure-g'>
  <div class="pure-u-1"> 
    <%= link_to edit_budget_path(@budget_cycle.budget), class: 'pure-button', style: 'float:right;' do %>
      <% fa_icon "cog" %>
    <% end %>
    <h2 class='budget-name'> 
      <%= @budget_cycle.name %> 
    </h2>
    <div class='top-margin'>
      <h1 class="large-balance <%= 'negative' if @budget_cycle.current_balance < 0 %>"><%= cents_to_currency(@budget_cycle.current_balance) %></h1>
    </div>
    <p>
      <% if @budget_cycle.current_balance > 0 %>
        <div class='meter positive'>
          <span style='width: <%= [((@budget_cycle.unlocked_balance / @budget_cycle.period_balance.to_f) * 100.0), 100].min %>%;' class='meter-unlocked'></span>
          <span style='width: <%= [(((@budget_cycle.amount_spent) / @budget_cycle.period_balance.to_f) * 100.0), 100].min %>%;' class='meter-spent overlay'></span>
        </div>
      <% else %>
        <div class='meter negative'>
          <span style='width: <%= [((@budget_cycle.unlocked_balance / @budget_cycle.period_balance.to_f) * 100.0), 100].min %>%;' class='meter-unlocked'></span>
          <span style='width: <%= [(((@budget_cycle.amount_spent) / @budget_cycle.period_balance.to_f) * 100.0), 100].min %>%;' class='meter-spent overlay'></span>
        </div>
      <% end %>
    </p>
    <div class='summary'>
      <div class='small-bottom-margin'> <span class='bold'>Spent: </span> <%= cents_to_currency(@budget_cycle.amount_spent) %></div> 
      <div class='small-bottom-margin'> <span class='bold' >Unlocked: </span> <%= cents_to_currency(@budget_cycle.unlocked_balance) %> of <%= cents_to_currency(@budget_cycle.period_balance) %></div> 
      <!-- <p> Day <%= @budget_cycle.day_in_cycle %> of <%= @budget_cycle.number_of_days_in_cycle %></p>  -->
    </div>
  </div>
  <div class="pure-u-1 top-margin">
    <div class='new-transaction'>
      <div class='bold small-bottom-margin'>New Transaction</div>
      <%= form_for @new_balance_event, url: budget_budget_cycle_balance_events_path(@budget, @budget_cycle.id), html: { class: 'pure-form pure-g' } do |f| %>
          <div class='pure-u-6-24'>
            <div style='margin-right:2px;'>
               <%= f.number_field :amount, placeholder: '$', min: 0.01, step: 0.01, class: 'amount-field one-hundred', required: true %>
            </div>
          </div>
          <div class='pure-u-14-24'>
            <div style='margin-right:2px;'>
               <%= f.text_field :note, placeholder: 'Note (Optional)', class: 'note-field one-hundred'%>
            </div>
          </div>
          <div class='pure-u-4-24'>
            <%= f.submit '+', class: 'pure-button pure-button-primary one-hundred', style: 'font-size: 22px; font-weight: bold; padding: 0.25em;' %>
         </div>
      <% end %>
    </div> 

    <div class="transaction-log top-margin">
      <% if @budget_cycle.balance_events.count > 0 %>
        <div class='bold small-bottom-margin'>Transaction Log</div>
        <table class="pure-table pure-table-horizontal pure-table-striped transaction-table">
          <thead>
            <tr>
              <th style="width: 35%;"> Amount </th>
              <th> Note </th>
            </tr>
          </thead>
          <tbody>
            <% @budget_cycle.balance_events.order("created_at DESC").each do |be| %>
              <% if be.amount.present? %>
                <tr>
                  <td><%= cents_to_currency(be.amount) %></td>
                  <td><%= be.note %></td>
                </tr>
               <!--  <%= time_ago_in_words(be.created_at) %> ago : <%= cents_to_currency(be.amount) %> -->
              <% end %>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <!-- <p class='bold center'> No transactions yet :) </p> -->
      <% end %>
    </div> 
  </div>
  <div class="pure-u-1 top-margin">
    <%= link_to  budgets_path, class: 'pure-button' do %>
      <%= fa_icon 'chevron-left' %>
      Budgets
     <% end %>
  </div>

</div>
